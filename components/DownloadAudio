import React from 'react';
import { View, Button } from 'react-native';
import RNFS from 'react-native-fs';
import DownloadingModal from  './DownloadingModal';

const DownloadAudio = () => {
    const [isDownloading, setDownloading] = useState(false);
    const [downloadComplete, setDownloadComplete] = useState(false);

    const handleDownload = async () => {
      setDownloading(true); // Show the downloading modal
      
      const fileUrl = 'https://mjlayasan.com/wp-content/uploads/2023/10/Kalipay.mp3';
      const destinationPath = `${RNFS.DocumentDirectoryPath}/Kalipay.mp3`;

      try {
        const result = await RNFS.downloadFile({
          fromUrl: fileUrl,
          toFile: destinationPath,
        });
  
        if (result.statusCode === 200) {
          console.log('File downloaded successfully to', destinationPath);
        } else {
          console.error('Download failed');
        }
      } catch (error) {
        console.error('Error during download:', error);
      } finally {
        setDownloading(false); // Hide the downloading modal
      }

      setTimeout(() => {
        setDownloading(false); // Hide the downloading modal
        setDownloadComplete(true); // Set downloadComplete to true
      }, 3000); //

    };

    const closeModal = () => {
        setDownloadComplete(false);
    };
  
    return (
        <View>
            <Button title="Download File" onPress={handleDownload} />
            <DownloadingModal isVisible={isDownloading} downloadComplete={downloadComplete} closeModal={closeModal} />
        </View>
    );
};

export default DownloadAudio;